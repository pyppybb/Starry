
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- å¼•å…¥æ›´å¤šå­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@300;400;600&family=Amatic+SC&family=Lobster&display=swap" rel="stylesheet">
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒˆæµ®å…‰è®°ğŸŒˆ</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
   <!-- åŠ¨æ€ä¸»é¢˜é¢œè‰² -->
  <meta name="theme-color" content="#ff6f91">
  
  <style>
    /* å…¨å±€æ ·å¼ä¸ä¸»é¢˜å˜é‡ */
    :root {
      --primary-color: #ff6f91;
      --secondary-color: #ffb6c1;
      --background-gradient: linear-gradient(to bottom, #fffaf0, #ffebf7);
      --button-gradient: linear-gradient(145deg, #ff9a9e, #fecfef);
      --button-hover-gradient: linear-gradient(145deg, #ffb6c1, #ffd1d1);
      --text-color: #4a4a4a;
      --header-background: var(--secondary-color);
      --nav-background: #ffe6e6;
      --footer-background: var(--secondary-color);
      --section-background: #fff;
      --box-shadow: rgba(0, 0, 0, 0.1);
    }

    /* ä¸»é¢˜1ï¼šç²‰çº¢è‰²ï¼ˆé»˜è®¤ï¼‰ */
    .theme-pink {
      --primary-color: #ff6f91;
      --secondary-color: #ffb6c1;
      --background-gradient: linear-gradient(to bottom, #fffaf0, #ffebf7);
      --button-gradient: linear-gradient(145deg, #ff9a9e, #fecfef);
      --button-hover-gradient: linear-gradient(145deg, #ffb6c1, #ffd1d1);
      --text-color: #4a4a4a;
      --header-background: var(--secondary-color);
      --nav-background: #ffe6e6;
      --footer-background: var(--secondary-color);
      --section-background: #fff;
      --box-shadow: rgba(0, 0, 0, 0.1);
    }

    /* ä¸»é¢˜2ï¼šè“è‰² */
    .theme-blue {
      --primary-color: #4facfe;
      --secondary-color: #00f2fe;
      --background-gradient: linear-gradient(to bottom, #e0f7fa, #ffffff);
      --button-gradient: linear-gradient(145deg, #a1c4fd, #c2e9fb);
      --button-hover-gradient: linear-gradient(145deg, #89f7fe, #66a6ff);
      --text-color: #333;
      --header-background: var(--secondary-color);
      --nav-background: #e0f7fa;
      --footer-background: var(--secondary-color);
      --section-background: #fff;
      --box-shadow: rgba(0, 0, 0, 0.1);
    }

    /* ä¸»é¢˜3ï¼šç»¿è‰² */
    .theme-green {
      --primary-color: #a8e063;
      --secondary-color: #56ab2f;
      --background-gradient: linear-gradient(to bottom, #e0f7fa, #ffffff);
      --button-gradient: linear-gradient(145deg, #a8e063, #56ab2f);
      --button-hover-gradient: linear-gradient(145deg, #4caf50, #81c784);
      --text-color: #333;
      --header-background: var(--secondary-color);
      --nav-background: #c8e6c9;
      --footer-background: var(--secondary-color);
      --section-background: #fff;
      --box-shadow: rgba(0, 0, 0, 0.1);
    }

    /* ä¸»é¢˜4ï¼šè«å…°è¿ªè‰² */
    .theme-morandi {
      --primary-color: #8e9aaf;
      --secondary-color: #c1c8d6;
      --background-gradient: linear-gradient(to bottom, #dce3eb, #f0f4f7);
      --button-gradient: linear-gradient(145deg, #aab8c2, #c1c8d6);
      --button-hover-gradient: linear-gradient(145deg, #8e9aaf, #aab8c2);
      --text-color: #333;
      --header-background: var(--secondary-color);
      --nav-background: #dce3eb;
      --footer-background: var(--secondary-color);
      --section-background: #fff;
      --box-shadow: rgba(0, 0, 0, 0.1);
    }

    /* ä¸»é¢˜5ï¼šå¤šå·´èƒºè‰² */
    .theme-dopamine {
      --primary-color: #ff9a9e;
      --secondary-color: #fad0c4;
      --background-gradient: linear-gradient(to bottom, #fad0c4, #ffd1ff);
      --button-gradient: linear-gradient(145deg, #ff9a9e, #fad0c4);
      --button-hover-gradient: linear-gradient(145deg, #ffb6c1, #ffe6e6);
      --text-color: #333;
      --header-background: var(--secondary-color);
      --nav-background: #ffe6e6;
      --footer-background: var(--secondary-color);
      --section-background: #fff;
      --box-shadow: rgba(0, 0, 0, 0.1);
    }

    /* ä¸»é¢˜6ï¼šä¼˜åŒ–ç‰ˆå¥¶æ²¹è‰² */
    .theme-cream {
      --primary-color: #f6d365; /* æ¸©æš–å¥¶æ²¹é»„ */
      --secondary-color: #f9c57d; /* æŸ”å’Œç„¦ç³–è‰² */
      --background-gradient: linear-gradient(to bottom, #f7e0b4, #fff0db); /* æ›´æŸ”å’Œçš„èƒŒæ™¯ */
      --button-gradient: linear-gradient(145deg, #f5c16c, #f9d795); /* æŒ‰é’®æ”¹ä¸ºæ›´æ·±ä¸€ç‚¹çš„é»„è‰² */
      --button-hover-gradient: linear-gradient(145deg, #f3b963, #f7cb8b); /* æŒ‰é’®æ‚¬åœæ—¶çš„æ¸å˜ */
      --text-color: #4a4a4a; /* ç•¥æ·±çš„ç°è‰²ï¼Œä¿è¯å¯¹æ¯”åº¦ */
      --header-background: var(--secondary-color);
      --nav-background: #fcecd2; /* è®©å¯¼èˆªæ é¢œè‰²æ›´æŸ”å’Œ */
      --footer-background: var(--secondary-color);
      --section-background: #fffdf5; /* è®©å†…å®¹åŒºæ›´æ¥è¿‘å¥¶æ²¹è‰² */
      --box-shadow: rgba(0, 0, 0, 0.08); /* é™ä½é˜´å½±çš„å¯¹æ¯”åº¦ï¼Œä½¿å…¶æ›´æŸ”å’Œ */
    }

    /* ä¸»é¢˜7ï¼šæ·±è‰² */
    .theme-dark {
      --primary-color: #bb86fc;
      --secondary-color: #3700b3;
      --background-gradient: linear-gradient(to bottom, #121212, #1f1f1f);
      --button-gradient: linear-gradient(145deg, #3700b3, #bb86fc);
      --button-hover-gradient: linear-gradient(145deg, #bb86fc, #3700b3);
      --text-color: #ffffff;
      --header-background: #1f1f1f;
      --nav-background: #121212;
      --footer-background: #1f1f1f;
      --section-background: #1f1f1f;
      --box-shadow: rgba(255, 255, 255, 0.1);
    }

    /* é»˜è®¤ä¸»é¢˜ */
    body {
      font-family: 'Nunito', sans-serif; /* æ¸…æ–°æ— è¡¬çº¿å­—ä½“ */
      background-color: #fff7f0; /* å¥¶æ²¹èƒŒæ™¯ */
      color: var(--text-color); /* æŸ”å’Œæ·±ç°è‰² */
      margin: 0;
      padding: 0;
      background: var(--background-gradient);
      transition: background 0.5s, color 0.5s;
    }

    /* æ ‡é¢˜å­—ä½“ */
    h1, h2, h3, header {
      font-family: 'Pacifico', 'Amatic SC', 'Lobster', cursive; /* æ‰‹å†™é£æ ¼ä¸å¯çˆ±å­—ä½“ */
      color: var(--primary-color); /* ä¸»é¢˜ä¸»è‰² */
      transition: color 0.5s;
    }

    header {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-color: var(--header-background);
      padding: 20px 10px;
      font-size: 2.5em;
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 10px var(--box-shadow);
      border-bottom-left-radius: 15px;
      border-bottom-right-radius: 15px;
      cursor: pointer; /* å˜æˆæŒ‰é’®æ ·å¼ */
      /* user-select: none; */ /* ç§»é™¤ç¦æ­¢é€‰ä¸­æ–‡æœ¬ */
      user-select: text; /* å…è®¸é€‰ä¸­æ–‡æœ¬ä»¥æ”¯æŒåŒå‡»ç¼–è¾‘ */
      transition: background-color 0.5s;
      position: relative; /* ä¸ºäº†æ”¾ç½®ç¼–è¾‘æŒ‰é’® */
    }

    /* æ–°å¢ç¼–è¾‘æŒ‰é’®æ ·å¼ */
    #edit-title-btn {
      display: none; /* åˆå§‹éšè—ï¼Œä»…ç§»åŠ¨è®¾å¤‡æ˜¾ç¤º */
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--button-gradient);
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      color: white;
      font-size: 1.2em;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background 0.3s ease;
    }

    #edit-title-btn:hover {
      background: var(--button-hover-gradient);
    }

    /* åª’ä½“æŸ¥è¯¢ï¼Œé’ˆå¯¹ç§»åŠ¨è®¾å¤‡æ˜¾ç¤ºç¼–è¾‘æŒ‰é’® */
    @media (max-width: 768px) {
      #edit-title-btn {
        display: block;
      }
    }

    nav {
      display: flex;
      justify-content: space-around;
      background-color: var(--nav-background);
      padding: 10px 0;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 10px var(--box-shadow);
      transition: background-color 0.5s;
    }
    nav button {
      padding: 12px 25px;
      border: none;
      background: var(--button-gradient); /* ä¸»é¢˜æŒ‰é’®æ¸å˜ */
      cursor: pointer;
      font-size: 1em;
      border-radius: 25px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      color: white;
      position: relative;
      overflow: hidden;
      font-family: 'Nunito', sans-serif;
    }
    nav button::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(45deg) scale(0);
      transition: transform 0.5s;
    }
    nav button:hover::before {
      transform: rotate(45deg) scale(1);
    }
    nav button:hover {
      background: var(--button-hover-gradient); /* ä¸»é¢˜æŒ‰é’®æ‚¬åœæ¸å˜ */
      transform: scale(1.05);
    }

    main {
      padding: 20px;
    }

    .section {
      background-color: var(--section-background);
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }
    .section.hidden {
      display: none;
    }

    textarea {
      width: 90%;
      height: 60px;
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      padding: 10px;
      resize: none;
      font-size: 1em;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: border-color 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }

    textarea:focus {
      border-color: var(--secondary-color);
      outline: none;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      font-size: 1em;
      cursor: pointer;
      background: var(--button-gradient);
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      color: white;
      font-family: 'Nunito', sans-serif;
    }
    button:hover {
      background: var(--button-hover-gradient);
      transform: scale(1.05);
    }

    footer {
      text-align: center;
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color)); /* æ¸å˜è‰²èƒŒæ™¯ */
      color: white;
      padding: 18px 0;
      font-size: 1.1em;
      position: sticky;
      bottom: 0;
      z-index: 10;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      transition: background 0.5s, transform 0.3s ease-in-out;
      font-family: 'Pacifico', cursive; /* æ›¿æ¢æˆå¤å¤å¯çˆ±çš„å­—ä½“ */
      letter-spacing: 1px; /* å¢åŠ é—´è·ï¼Œè®©æ–‡å­—æ›´ä¼˜é›… */
      font-weight: bold;
      box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.1); /* è®©åº•éƒ¨ç¨å¾®æœ‰ç«‹ä½“æ„Ÿ */
    }

    /* é¼ æ ‡æ‚¬åœæ—¶è®© footer è½»å¾®æµ®èµ· */
    footer:hover {
      transform: translateY(-3px);
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* è½»å¾®åè½¬æ¸å˜è‰² */
    }

    #timer-display {
      font-size: 3em;
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 15px;
      font-weight: bold;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: color 0.5s;
    }

    /* ç¾åŒ–éŸ³ä¹é€‰æ‹©å™¨ */
    #music-selector {
      width: 100%;
      padding: 14px;
      border: 2px solid var(--secondary-color);
      border-radius: 15px;
      font-size: 1.2em;
      background: linear-gradient(to bottom, #fffaf0, #ffebf7);
      box-shadow: 0 3px 8px rgba(255, 105, 135, 0.15);
      color: var(--primary-color);
      font-weight: bold;
      text-align: center;  /* å…¼å®¹éƒ¨åˆ†æµè§ˆå™¨ */
      text-align-last: center;  /* è®©é€‰ä¸­çš„æ–‡æœ¬å±…ä¸­ */
      appearance: none;  /* éšè—é»˜è®¤ä¸‹æ‹‰æ ·å¼ */
      display: flex; /* è®©å†…éƒ¨æ–‡æœ¬å±…ä¸­ */
      align-items: center; /* å‚ç›´å±…ä¸­ */
      justify-content: center; /* æ°´å¹³å±…ä¸­ */
      text-indent: 1px; /* è§£å†³éƒ¨åˆ†æµè§ˆå™¨åç§»é—®é¢˜ */
      font-family: 'Nunito', sans-serif;
    }

    /* è®©ä¸‹æ‹‰åˆ—è¡¨çš„é€‰é¡¹æ–‡å­—ä¹Ÿå±…ä¸­ */
    #music-selector option {
      text-align: center;
    }

    #history-container {
      margin-top: 20px;
      padding: 10px;
      background-color: #fffbe6;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      font-family: 'Nunito', sans-serif;
    }

    /* ç¾åŒ–ä¸‹æ‹‰èœå•å®¹å™¨ï¼ˆè‹¥åœ¨å…¶ä»–å¤„ä½¿ç”¨ï¼‰ */
    select {
      font-size: 16px; /* è°ƒæ•´å­—ä½“å¤§å° */
      font-family: 'Nunito', sans-serif; /* å­—ä½“é£æ ¼ */
      color: var(--primary-color); /* å­—ä½“é¢œè‰² */
      background-color: #ffe4e1; /* èƒŒæ™¯é¢œè‰² */
      border: 2px solid var(--secondary-color); /* è¾¹æ¡†é¢œè‰² */
      border-radius: 20px; /* åœ†è§’ */
      padding: 5px 15px; /* å†…è¾¹è· */
      cursor: pointer;
      appearance: none; /* ç§»é™¤é»˜è®¤ç®­å¤´ */
      outline: none; /* ç§»é™¤èšç„¦æ—¶çš„è“è‰²è¾¹æ¡† */
      transition: all 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
      font-family: 'Nunito', sans-serif;
    }
    select:hover {
      background-color: #ffd1d1; /* é¼ æ ‡æ‚¬åœæ—¶ */
      border-color: var(--primary-color);
    }

    /* å°¾å·´ä»»åŠ¡ - ç§¯åˆ†ä¸å•†åŸå¼¹çª— */
    #points-display {
      position: relative;
      float: right;
      margin-top: -60px;
      margin-right: 10px;
      font-size: 1.2em;
      color: var(--primary-color);
      cursor: pointer;
      transition: color 0.5s;
      font-family: 'Nunito', sans-serif;
    }
    #points-display span {
      font-weight: bold;
    }
    #shop-modal {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      max-width: 600px;
      background-color: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 999;
      overflow-y: auto;
      max-height: 80vh;
      transition: all 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    #shop-modal h2 {
      text-align: center;
      color: var(--primary-color);
      transition: color 0.5s;
      font-family: 'Pacifico', cursive;
    }
    #shop-modal button.close-btn {
      background-color: #f0adad;
      float: right;
      margin-top: -5px;
      margin-right: -5px;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
    }
    #shop-items {
      margin-top: 20px;
    }
    .shop-item {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: #ffe6e6;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    .shop-item span {
      font-size: 1em;
      color: var(--primary-color);
      transition: color 0.5s;
    }
    .shop-item button {
      background: var(--button-gradient);
      color: white;
      border-radius: 15px;
      padding: 5px 15px;
      font-size: 0.9em;
      transition: background 0.3s ease;
      border: none;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
    }
    .shop-item button:hover {
      background: var(--button-hover-gradient);
    }
    #exchange-history {
      margin-top: 20px;
      background-color: #fffbe6;
      padding: 10px;
      border-radius: 10px;
      max-height: 150px;
      overflow-y: auto;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      font-family: 'Nunito', sans-serif;
    }
    #exchange-history h4 {
      margin-bottom: 10px;
      color: var(--primary-color);
      transition: color 0.5s;
      font-family: 'Pacifico', cursive;
    }
    #exchange-history-list {
      list-style-type: disc;
      padding-left: 20px;
    }

    /* æ·»åŠ è‡ªå®šä¹‰å¥–åŠ±è¡¨å• */
    #add-reward-form {
      margin-top: 20px;
      padding: 10px;
      background-color: #f9f9f9;
      border: 2px dashed var(--secondary-color);
      border-radius: 10px;
      font-family: 'Nunito', sans-serif;
    }
    #add-reward-form h3 {
      margin-top: 0;
      color: var(--primary-color);
      transition: color 0.5s;
      font-family: 'Pacifico', cursive;
    }
    #add-reward-form input[type="text"],
    #add-reward-form input[type="number"] {
      width: 45%;
      padding: 8px;
      margin-right: 5%;
      margin-bottom: 10px;
      border: 1px solid var(--primary-color);
      border-radius: 5px;
      font-size: 1em;
      transition: border-color 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    #add-reward-form input[type="text"]:focus,
    #add-reward-form input[type="number"]:focus {
      border-color: var(--secondary-color);
      outline: none;
    }
    #add-reward-form button {
      padding: 8px 20px;
      background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    #add-reward-form button:hover {
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
    }

    /* ä»»åŠ¡å®ŒæˆåŠ¨ç”» - æ»‘å‡º */
    .task-complete-animation {
      animation: slideOut 1s forwards ease-in-out;
    }
    @keyframes slideOut {
      0% {
        opacity: 1;
        transform: translateX(0);
      }
      100% {
        opacity: 0;
        transform: translateX(100%);
      }
    }

    /* ç¾åŒ–å°¾å·´ä»»åŠ¡åˆ†ç±»æŒ‰é’® */
    .task-category-buttons {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .task-category-buttons button {
      flex: 1 1 22%; /* å››ä¸ªæŒ‰é’®å‡åˆ†ä¸€è¡Œ */
      padding: 12px 0;
      font-size: 1em;
      border-radius: 25px;
      background: var(--button-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, background 0.3s ease;
      font-family: 'Nunito', sans-serif;
    }
    .task-category-buttons button::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(45deg) scale(0);
      transition: transform 0.5s;
    }
    .task-category-buttons button:hover::before {
      transform: rotate(45deg) scale(1);
    }
    .task-category-buttons button:hover {
      background: var(--button-hover-gradient);
      transform: scale(1.05);
    }

    /* è°ƒæ•´ä»»åŠ¡é¡µé¢å¸ƒå±€ */
    #tasks h2 {
      margin-bottom: 20px;
      font-family: 'Pacifico', cursive;
    }
    #tasks p {
      margin-bottom: 10px;
      font-size: 1.1em;
      font-family: 'Nunito', sans-serif;
    }
    #tasks label {
      font-size: 1em;
      font-family: 'Nunito', sans-serif;
    }
    #task-log button {
      margin-left: 10px;
      background: var(--button-gradient);
      color: white;
      border-radius: 15px;
      padding: 5px 10px;
      font-size: 0.9em;
      transition: background 0.3s ease;
      border: none;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
    }
    #task-log button:hover {
      background: var(--button-hover-gradient);
    }
    #completed-tasks, #exchange-history-list {
      list-style-type: disc;
      padding-left: 20px;
      font-family: 'Nunito', sans-serif;
    }

    /* ç¼–è¾‘å¿ƒå¾—æ ·å¼ */
    .reflection {
      margin-left: 20px;
      font-size: 0.9em;
      color: #555;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
    }
    .reflection:hover {
      text-decoration: underline;
    }

    /* ä¸»é¢˜åˆ‡æ¢åŠ¨ç”» */
    .theme-transition {
      transition: all 0.5s ease;
    }
  </style>
</head>
<body class="theme-pink">

  <header id="theme-switcher">
    ğŸ¬å’•å™œå™œğŸ¬
    <!-- æ·»åŠ ç¼–è¾‘æŒ‰é’®ï¼Œä»…åœ¨ç§»åŠ¨è®¾å¤‡æ˜¾ç¤º -->
    <button id="edit-title-btn" onclick="editTitle()">âœï¸</button>
  </header>

  <nav>
    <button onclick="toggleSection('diary')">ğŸ“®å’•å™œå°è®°</button>
    <button onclick="toggleSection('tasks')">ğŸ¦ºå°¾å·´ä»»åŠ¡</button>
    <button onclick="toggleSection('pomodoro')">â³ç•ªèŒ„é’Ÿ</button>
  </nav>

  <main>
    <!-- å¹¸ç¦ç¬é—´æ—¥è®° -->
    <section id="diary" class="section hidden">
      <h2>âœ¨å’•å™œå°è®°</h2>
      <div id="today-moments">
        <h3>ä»Šå¤©ï¼ˆ<span id="current-date"></span>ï¼‰</h3>
        <div id="moment-container">
          <div class="moment">
            <textarea placeholder="å†™ä¸‹ç¬¬ä¸€ä¸ªå¼€å¿ƒç¬é—´..."></textarea>
            <div class="emojis">
              <button onclick="selectEmoji(this)">ğŸ˜Š</button>
              <button onclick="selectEmoji(this)">ğŸ¥°</button>
              <button onclick="selectEmoji(this)">ğŸ‰</button>
            </div>
          </div>
          <div class="moment">
            <textarea placeholder="å†™ä¸‹ç¬¬äºŒä¸ªå¼€å¿ƒç¬é—´..."></textarea>
            <div class="emojis">
              <button onclick="selectEmoji(this)">ğŸ˜Š</button>
              <button onclick="selectEmoji(this)">ğŸ¥°</button>
              <button onclick="selectEmoji(this)">ğŸ‰</button>
            </div>
          </div>
          <div class="moment">
            <textarea placeholder="å†™ä¸‹ç¬¬ä¸‰ä¸ªå¼€å¿ƒç¬é—´..."></textarea>
            <div class="emojis">
              <button onclick="selectEmoji(this)">ğŸ˜Š</button>
              <button onclick="selectEmoji(this)">ğŸ¥°</button>
              <button onclick="selectEmoji(this)">ğŸ‰</button>
            </div>
          </div>
        </div>
        <br> 
        <button onclick="saveMoments()">ä¿å­˜</button>
        <button onclick="toggleSection('diary')">å…³é—­</button>
      </div>
      <div id="history">
        <h3>å†å²è®°å½•</h3>
        <div id="history-container"></div>
      </div>
    </section>

    <!-- å°¾å·´ä»»åŠ¡ -->
    <section id="tasks" class="section hidden">
      <h2>ğŸˆå°¾å·´ä»»åŠ¡</h2>

      <!-- ç§¯åˆ†æ˜¾ç¤ºï¼ˆç‚¹å‡»å¯æ‰“å¼€å…‘æ¢å•†åŸï¼‰ -->
      <div id="points-display" onclick="openShop()">
        å½“å‰ç§¯åˆ†ï¼š<span id="points-value">0</span>
      </div>

      <!-- é€‰æ‹©åˆ†ç±»å¹¶ç”Ÿæˆå¤šä¸ªä»»åŠ¡ï¼ˆæœ€å¤š3ä¸ªï¼‰ -->
      <div class="task-category-buttons">
        <button onclick="generateTasks('exercise')">ğŸƒâ€â™‚ï¸ è¿åŠ¨</button>
        <button onclick="generateTasks('study')">ğŸ“š å­¦ä¹ </button>
        <button onclick="generateTasks('creativity')">ğŸŒˆ åˆ›æ„</button>
        <button onclick="generateTasks('random')">ğŸ§¸ éšæœº</button>
      </div>
      <div style="margin-bottom: 20px;">
        <label>
          ç”Ÿæˆæ•°é‡ï¼š
          <input type="number" id="task-count" value="1" min="1" max="3" style="width: 50px; text-align: center;">
        </label>
      </div>

      <!-- å¾…åšä»»åŠ¡åŒº -->
      <h3>å¾…åšä»»åŠ¡</h3>
      <ul id="task-log" style="margin-top: 15px;"></ul>
      <button onclick="clearTasks()">æ¸…ç©ºä»»åŠ¡</button>

      <!-- å·²å®Œæˆä»»åŠ¡ï¼ˆå½“æ—¥ï¼‰ -->
      <h3>å·²å®Œæˆä»»åŠ¡</h3>
      <ul id="completed-tasks"></ul>

      <!-- ä»»åŠ¡å†å²è®°å½• -->
      <h3>ä»»åŠ¡å†å²è®°å½•</h3>
      <div id="task-history-container" style="margin-top: 15px;"></div>
    </section>

    <!-- ç•ªèŒ„é’Ÿ -->
    <section id="pomodoro" class="section hidden">
      <h2>âŒ›ç•ªèŒ„é’Ÿ</h2>
      <div id="timer-display">25:00</div>
      <div>
        <label>å·¥ä½œæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼š</label>
        <input type="number" id="work-duration" value="25" min="1">
      </div>
      <div>
        <label>ä¼‘æ¯æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼š</label>
        <input type="number" id="break-duration" value="5" min="1">
      </div>
      <div>
        <br> 
        <button onclick="startTimer()">å¼€å§‹</button>
        <button onclick="pauseTimer()">æš‚åœ</button>
        <button onclick="resetTimer()">é‡ç½®</button>
      </div>
      <p id="current-status">å½“å‰çŠ¶æ€ï¼šæœªå¼€å§‹</p>
      <h3>ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹ ğŸ¦‹</h3>
      <select id="music-selector">
        <option value="music1">Vincentz - Iced Americano</option>
        <option value="music2">Monday</option>
        <option value="music3">ä¸€èµ·</option>
        <option value="music4">è‡³å°‘åšä¸€ä»¶ç¦»è°±çš„äº‹</option>
      </select>
      <audio id="background-music" preload="auto"></audio>
    </section>
  </main>

  <footer>
    â¤ï¸ Â© 2025 ä¸€ä¸ªäººè¦åƒä¸€æ”¯é˜Ÿä¼ â¤ï¸
  </footer>

  <!-- å…‘æ¢å•†åŸå¼¹çª— -->
  <div id="shop-modal">
    <button class="close-btn" onclick="closeShop()">X</button>
    <h2>å…‘æ¢å•†åº—</h2>
    <div id="shop-items">
      <!-- ç¤ºä¾‹å…‘æ¢é€‰é¡¹ï¼Œå°†åœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- æ·»åŠ è‡ªå®šä¹‰å¥–åŠ±è¡¨å• -->
    <div id="add-reward-form">
      <h3>æ·»åŠ è‡ªå®šä¹‰å¥–åŠ±</h3>
      <input type="text" id="custom-reward-name" placeholder="å¥–åŠ±åç§°">
      <input type="number" id="custom-reward-cost" placeholder="æ‰€éœ€ç§¯åˆ†" min="1">
      <button onclick="addCustomReward()">æ·»åŠ å¥–åŠ±</button>
    </div>

    <div id="exchange-history">
      <h4>å…‘æ¢è®°å½•</h4>
      <ul id="exchange-history-list"></ul>
    </div>
  </div>

  <script>
    /************************************************
     *           ï¼ˆä¸€ï¼‰å’•å™œå°è®°ç›¸å…³ä»£ç 
     ************************************************/
    document.addEventListener("DOMContentLoaded", () => {
      const themeSwitcher = document.getElementById("theme-switcher");
      const editTitleBtn = document.getElementById("edit-title-btn");
      const currentDate = new Date().toISOString().split("T")[0];
      document.getElementById("current-date").innerText = currentDate;
      updateHistory();
      updateCompletedTasks();
      loadCustomTitle();

      // å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ ‡é¢˜æ–‡æœ¬ï¼ˆæ¡Œé¢åŒå‡»ï¼‰
      themeSwitcher.addEventListener("dblclick", () => {
        const newText = prompt("è¯·è¾“å…¥æ–°çš„æ ‡é¢˜æ–‡æœ¬ï¼š", themeSwitcher.innerText);
        if (newText !== null && newText.trim() !== "") {
          themeSwitcher.innerText = newText.trim();
          // ä¿å­˜è‡ªå®šä¹‰æ ‡é¢˜åˆ° localStorage
          localStorage.setItem("customTitle", newText.trim());
        }
      });

      // æ·»åŠ ç‚¹å‡»ç¼–è¾‘æŒ‰é’®åŠŸèƒ½ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰
      editTitleBtn.addEventListener("click", () => {
        const newText = prompt("è¯·è¾“å…¥æ–°çš„æ ‡é¢˜æ–‡æœ¬ï¼š", themeSwitcher.innerText);
        if (newText !== null && newText.trim() !== "") {
          themeSwitcher.innerText = newText.trim();
          // ä¿å­˜è‡ªå®šä¹‰æ ‡é¢˜åˆ° localStorage
          localStorage.setItem("customTitle", newText.trim());
        }
      });
    });

    // åŠ è½½è‡ªå®šä¹‰æ ‡é¢˜
    function loadCustomTitle() {
      const customTitle = localStorage.getItem("customTitle");
      if (customTitle) {
        document.getElementById("theme-switcher").innerText = customTitle;
      }
    }

    function toggleSection(sectionId) {
      const sections = ['diary', 'tasks', 'pomodoro'];
      const targetSection = document.getElementById(sectionId);
      const isHidden = targetSection.classList.contains('hidden');

      // å…³é—­æ‰€æœ‰å…¶ä»–éƒ¨åˆ†
      sections.forEach(id => {
        const section = document.getElementById(id);
        if (id !== sectionId) {
          section.classList.add('hidden');
        }
      });

      // åˆ‡æ¢ç›®æ ‡éƒ¨åˆ†
      if (isHidden) {
        targetSection.classList.remove('hidden');
      } else {
        targetSection.classList.add('hidden');
      }
    }

    function selectEmoji(button) {
      const siblings = button.parentElement.querySelectorAll('button');
      siblings.forEach(btn => btn.classList.remove('selected'));
      button.classList.add('selected');
    }

    function saveMoments() {
      const moments = [];
      document.querySelectorAll('.moment').forEach(moment => {
        const text = moment.querySelector('textarea').value.trim();
        const selectedEmoji = moment.querySelector('button.selected')?.textContent || "ğŸ˜¶";
        if (text) {
          moments.push({ text, emoji: selectedEmoji });
        }
      });

      const currentDate = new Date().toISOString().split("T")[0];
      const allMoments = JSON.parse(localStorage.getItem("gululuMoments")) || {};
      allMoments[currentDate] = moments;
      localStorage.setItem("gululuMoments", JSON.stringify(allMoments));

      updateHistory();
      alert("å’•å™œå°è®°ä¿å­˜æˆåŠŸï¼");
    }

    function updateHistory() {
      const allMoments = JSON.parse(localStorage.getItem("gululuMoments")) || {};
      const historyContainer = document.getElementById("history-container");
      if (!historyContainer) return;

      historyContainer.innerHTML = "";
      Object.keys(allMoments).forEach(date => {
        const entryDiv = document.createElement("div");
        entryDiv.classList.add("history-entry");

        const dateTitle = document.createElement("h4");
        dateTitle.innerText = date;
        dateTitle.onclick = () => {
          const ul = entryDiv.querySelector("ul");
          ul.style.display = (ul.style.display === "none") ? "block" : "none";
        };

        const ul = document.createElement("ul");
        ul.style.display = "none";
        allMoments[date].forEach(({ text, emoji }) => {
          const li = document.createElement("li");
          li.innerText = `${emoji} ${text}`;
          ul.appendChild(li);
        });

        entryDiv.appendChild(dateTitle);
        entryDiv.appendChild(ul);
        historyContainer.appendChild(entryDiv);
      });
    }

    /************************************************
     *           ï¼ˆäºŒï¼‰å°¾å·´ä»»åŠ¡ ç›¸å…³ä»£ç 
     ************************************************/
    // ä»»åŠ¡åˆ†ç±»ä¸å†…å®¹
    const tasksByCategory = {
      exercise: [
        "è·‘æ­¥1000ç±³","åš15ä¸ªä¿¯å§æ’‘","è·³ç»³50æ¬¡","ç»ƒä¹ 5åˆ†é’Ÿç‘œä¼½","æ­¥è¡Œ2000æ­¥","æ‹‰ä¼¸å…¨èº«5åˆ†é’Ÿ",
        "æ·±è¹²10æ¬¡","ä»°å§èµ·å10æ¬¡","å¿«èµ°10åˆ†é’Ÿ","ç«™ç«‹è¸®è„š30æ¬¡","é«˜æŠ¬è…¿30æ¬¡","å¹³æ¿æ”¯æ’‘20ç§’",
        "åŸåœ°å¼€åˆè·³20æ¬¡","å•è…¿ç«™ç«‹30ç§’","åå§¿æ‰­è…°10æ¬¡","ä¾§å§æŠ¬è…¿10æ¬¡","æ‰‹è‡‚ä¼¸å±•è¿åŠ¨3åˆ†é’Ÿ",
        "æ·±è¹²è·³5æ¬¡","æ‰¶å¢™é™è¹²30ç§’","è¸¢è…¿è¿åŠ¨10æ¬¡","æ…¢è·‘5åˆ†é’Ÿ","æ‰‹è‡‚ç»•åœˆ30æ¬¡","å·¦å³è·¨æ­¥è·³10æ¬¡",
        "å¤§è…¿åå¼¯10æ¬¡","å°æ­¥å¿«è·‘åŸåœ°20ç§’","è„šå°–èµ°è·¯1åˆ†é’Ÿ","ç«™ç«‹æŠ¬è†15æ¬¡","çŒ«å¼ä¼¸å±•5æ¬¡",
        "è´è¶å¼æ‹‰ä¼¸2åˆ†é’Ÿ","è‚©éƒ¨ç¯ç»•ä¼¸å±•2åˆ†é’Ÿ","åŸåœ°æ…¢è·‘3åˆ†é’Ÿ","æ·±è¹²+ç«™ç«‹æ‹‰ä¼¸10æ¬¡","ä»°å§è…¿ä¸¾5æ¬¡",
        "åè¸¢è…¿10æ¬¡","åŠ¨æ€æ‹‰ä¼¸èƒ³è†Š2åˆ†é’Ÿ","è‚©è†€åç»•10æ¬¡","é å¢™æŠ¬è…¿1åˆ†é’Ÿ","è…¹éƒ¨æ”¶ç¼©10æ¬¡",
        "è†ç›–ææ‹‰20æ¬¡","æŠ¬å¤´ä¸‹è…°10æ¬¡","è„–å­ç¯ç»•1åˆ†é’Ÿ","çŒ«ç‰›å¼æ‹‰ä¼¸5æ¬¡","ä¸‹è¹²é™æ­¢10ç§’",
        "è¶´åœ¨åœ°ä¸Šåšæ‰‹è‡‚ä¿¯å§æ’‘5æ¬¡","åŸåœ°è·³è·ƒ5æ¬¡","èƒŒéƒ¨åä»°10æ¬¡","åŒè…¿å¤§æ­¥å‘å‰10æ¬¡",
        "å·¦å³æ‹‰ä¼¸è…°éƒ¨10æ¬¡","çˆ¬æ¥¼æ¢¯5å±‚","è¸©å•è½¦3åˆ†é’Ÿ","å‹è…¿5åˆ†é’Ÿ"
      ],
      study: [
        "é˜…è¯»5é¡µä¹¦ç±","è®°ä½3ä¸ªå•è¯","å­¦ä¹ ä¸€é¡¹æ–°çŸ¥è¯†","æ€»ç»“ä»Šå¤©çš„å­¦ä¹ å¿ƒå¾—","æµè§ˆä¸€ç¯‡æ„Ÿå…´è¶£çš„æ–‡ç« ",
        "å¬10åˆ†é’Ÿè‹±è¯­å¬åŠ›","å†™3å¥è¯çš„è‹±æ–‡æ—¥è®°","çœ‹ä¸€æ®µæœ‰è¶£çš„ç§‘æ™®è§†é¢‘","å®Œæˆä¸€ä¸ªç®€å•çš„ç¼–ç¨‹ç»ƒä¹ ",
        "æ•´ç†å­¦ä¹ èµ„æ–™5åˆ†é’Ÿ","ç¿»çœ‹ä¸€æœ¬æ—§ç¬”è®°","æŸ¥ä¸€ä¸ªä¸çŸ¥é“çš„å•è¯ç”¨æ³•","ç»ƒä¹ ç®€å•çš„å£è¯­å¯¹è¯",
        "èƒŒè¯µä¸€é¦–çŸ­è¯—","ç”»ä¸€å¼ å­¦ä¹ æ€ç»´å¯¼å›¾","å­¦ä¹ ä¸€ä¸ªExcelå‡½æ•°","æ¨¡ä»¿ä¸€æ®µè‹±è¯­æ¼”è®²1åˆ†é’Ÿ",
        "æŸ¥é˜…ä¸€ç¯‡å†å²äº‹ä»¶","äº†è§£ä¸€é¡¹å†·çŸ¥è¯†","å†™ä¸‹ä»Šå¤©å­¦åˆ°çš„ä¸‰ä»¶äº‹","è§‚çœ‹ä¸€ä¸ªTEDè§†é¢‘",
        "æ•´ç†ç”µå­æ–‡ä»¶å¤¹","è¯»ä¸€æ®µä½ å–œæ¬¢çš„å°è¯´","ç»ƒä¹ ä¸€ç§å¸¸ç”¨å¥å¼","å°è¯•å†™ç®€å•çš„ä»£ç å°ç¨‹åº",
        "ç”¨è‹±è¯­æœç´¢ä¸€ä¸ªé—®é¢˜","è®°ä½ä¸€ä¸ªæ•°å­¦å…¬å¼","å¤ä¹ ä¸€ç¯‡ç¬”è®°","æ€è€ƒå¦‚ä½•ç”¨æ–°çŸ¥è¯†è§£å†³é—®é¢˜",
        "è®¾ç½®æ˜å¤©çš„å­¦ä¹ ç›®æ ‡","æŸ¥ä¸€ä¸ªæ„Ÿå…´è¶£çš„ç§‘æŠ€æ–°é—»","é˜…è¯»ä¸€ç¯‡çŸ­æ–°é—»å¹¶æ€»ç»“","èƒŒè¯µäº”ä¸ªå¸¸ç”¨çŸ­è¯­",
        "å­¦ä¹ ä¸€ç§å¸¸ç”¨ä¿®è¾æ‰‹æ³•","æ¨¡ä»¿å†™ä¸€æ®µTEDæ¼”è®²å†…å®¹","ç†Ÿæ‚‰ä¸€ä¸ªCSSå±æ€§ç”¨æ³•","æ•´ç†ä¹¦æ¡Œ3åˆ†é’Ÿ",
        "å­¦ä¼šä¸€ç§æ–°çš„å¥å¼è¡¨è¾¾","å°è¯•è®°å½•è‡ªå·±çš„æ€è€ƒè¿‡ç¨‹","å­¦ä¹ ä¸€ä¸ªæ–°çš„ç¼–ç¨‹æ¦‚å¿µ","è®°ä½3å¥æœ‰è¶£çš„è‹±æ–‡çŸ­å¥",
        "å®Œæˆä¸€é¡µæ•°å­¦ä¹ é¢˜","è®°ä¸‹ä¸€æ®µæ–°é—»å†…å®¹çš„é‡ç‚¹","ç¿»é˜…ä¸€æœ¬å·¥å…·ä¹¦","ä¸ºä»Šå¤©çš„çŸ¥è¯†ç‚¹åˆ›å»ºè®°å¿†å¡ç‰‡",
        "å°†å­¦ä¹ å†…å®¹åˆ†äº«ç»™æœ‹å‹","è§‚çœ‹ä¸€é›†ç§‘æ™®çºªå½•ç‰‡","å°è¯•èƒŒè¯µä¸€ä¸ªæœ‰è¶£çš„å°æ•…äº‹","æŸ¥æ‰¾æŸä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆ",
        "æ€»ç»“æœ€è¿‘ä¸€å‘¨çš„å­¦ä¹ å†…å®¹"
      ],
      creativity: [
        "ç”»ä¸€å¹…ç®€å•çš„æ’ç”»","å†™ä¸€é¦–å°è¯—","è®¾è®¡ä¸€ä»¶åˆ›æ„å°ç‰©","å°è¯•åšä¸€é“æ–°èœ",
        "å¯¹ç€é•œå­è¯´3æ¬¡ï¼šâ€˜æˆ‘æ˜¯å…¨ä¸–ç•Œæœ€å¯çˆ±çš„å°ç‹—ï¼â€™","ç»™è‡ªå·±æ³¡ä¸€æ¯çƒ­èŒ¶ï¼Œæ”¾æ¾å¿ƒæƒ…ã€‚",
        "ç”¨5åˆ†é’Ÿæ—¶é—´è®°ä½10ä¸ªå®Œå…¨æ— å…³çš„å•è¯ï¼ŒèƒŒç»™daddyå¬ï¼","å‡ºå»æ•£æ­¥10åˆ†é’Ÿï¼Œæ„Ÿå—å¤§è‡ªç„¶çš„ç¾å¥½ã€‚",
        "å¬ä¸€é¦–è‡ªå·±æœ€å–œæ¬¢çš„æ­Œï¼Œé—­ä¸Šçœ¼ç›å¥½å¥½æ„Ÿå—ï¼","å®Œæˆ20ä¸ªå¼€åˆè·³ï¼Œè¿‡ç¨‹ä¸­ä¿æŒç¬‘å®¹ï¼",
        "æ‰“å¼€æŠ•å½±ä»ªï¼Œè·Ÿéšä¸€ä¸ªå¸•æ¢…æ‹‰çš„èˆè¹ˆè§†é¢‘å®Œæˆ5åˆ†é’Ÿã€‚","ç‹¬è‡ªå®Œæˆä¸€ä»¶ä½ ä¸€ç›´è§‰å¾—æœ‰ç‚¹éš¾çš„äº‹ï¼Œæ¯”å¦‚æ•´ç†æˆ¿é—´æˆ–è®¡åˆ’æ˜å¤©ã€‚",
        "è¯»å®Œçº¸è´¨ä¹¦ä¸€ç« å†…å®¹ï¼Œå¹¶æ€»ç»“3ä¸ªæœ‰æ„æ€çš„ç‚¹åˆ†äº«ç»™daddyã€‚","éšæœºæ’­æ”¾ä¸€é¦–æ­Œï¼Œç”¨å…¶ä¸­ä¸€å¥æ­Œè¯æ¥å½¢å®¹daddyã€‚",
        "åšä¸€ä¸ªè½»æ¾çš„ä¼¸å±•åŠ¨ä½œï¼Œæ¯”å¦‚æŠ¬å¤´æ·±å‘¼å¸10ç§’ï¼Œå‘Šè¯‰daddyæ„Ÿè§‰ã€‚","é—­ä¸Šçœ¼ç›ï¼Œéšæ‰‹æ‹ä¸€å¼ å®¶é‡Œä»»æ„è§’è½çš„ç…§ç‰‡ï¼Œå‘ç»™daddyï¼Œè®©æˆ‘çŒœæ˜¯å“ªå„¿ã€‚",
        "åœ¨3åˆ†é’Ÿå†…ï¼Œå†™ä¸‹10ä¸ªè‡ªå·±å–œæ¬¢çš„ä¸œè¥¿ï¼Œä¸å‡†åœç¬”ã€‚","åœ¨æˆ¿é—´é‡Œæ‰¾ä¸€æ ·ç‰¹åˆ«çš„å°ç‰©ä»¶ï¼Œè®²å®ƒçš„æ•…äº‹ç»™daddyå¬ã€‚",
        "åœ¨3åˆ†é’Ÿå†…ï¼Œéšæ‰‹ç”»ä¸€åªâ€œå¤§èŠ±ç‹—â€ï¼Œç”»å®Œç»™daddyè¯„åˆ†ã€‚","éšæœºç¿»å¼€æ‰‹æœºé‡Œçš„ç›¸å†Œï¼ŒæŒ‘ä¸€å¼ è€ç…§ç‰‡è®²ä¸€ä¸ªç”œèœœçš„å›å¿†ã€‚",
        "æŠŠä½ çš„è€³æœºæˆ–è€³ç¯æˆ´èµ·æ¥ï¼Œæ‹ç…§å‘ç»™daddyï¼Œå±•ç¤ºä¸€ä¸‹å°ç‹—çš„å¯çˆ±æ ·å­ã€‚","é¢œè‰²å‘½åï¼šè§‚å¯Ÿä¸€æ ·ç‰¹åˆ«çš„é¢œè‰²ï¼Œç»™å®ƒèµ·ä¸ªç¬¦åˆå®ƒçš„åå­—ï¼Œæ¯”å¦‚â€œæµ·ç›è“â€ã€‚",
        "å¸½å­ä¾¦æ¢ï¼šæ‰¾åˆ°3ä¸ªæˆ´å¸½å­çš„äººï¼ŒæŠŠä»–ä»¬çš„å¸½å­é¢œè‰²æè¿°ç»™daddyå¬ã€‚","å½±å­æ•æ‰‹ï¼šæ‹ä¸‹3ä¸ªå½¢çŠ¶ç‰¹åˆ«çš„å½±å­ï¼Œç»™å®ƒä»¬èµ·åå­—ã€‚",
        "å°ç‹—è®¡æ•°ï¼šåœ¨å‘¨å›´æ‰¾åˆ°5ä¸ªåœ†å½¢çš„ä¸œè¥¿ï¼ŒæŠŠå®ƒä»¬æ’æˆä¸€è¡Œæ‹ç…§ã€‚","éšæœºæ­Œç‹ï¼šåœ¨è·¯ä¸Šå¬åˆ°çš„ä¸€å¥è¯ï¼ŒæŠŠå®ƒå˜æˆä¸€é¦–æ­Œçš„æ­Œè¯ã€‚",
        "é¢œè‰²ç‹©çŒï¼šåœ¨10åˆ†é’Ÿå†…æ‰¾åˆ°5æ ·ä¸åŒé¢œè‰²çš„ç‰©å“ã€‚","è‡ªç„¶çº¹ç†ï¼šæ‰¾åˆ°ä¸€ç‰‡å¶å­æˆ–è€…ä¸€å—çŸ³å¤´ï¼Œæè¿°å®ƒçš„çº¹è·¯ã€‚",
        "å°åŠ¨ç‰©è§‚å¯Ÿï¼šä»Šå¤©ç•™æ„3ç§åŠ¨ç‰©ï¼Œä¸ç®¡æ˜¯è·¯ä¸Šçš„çŒ«ç‹—è¿˜æ˜¯é£é¸Ÿã€‚","å¥‡æ€ªæ•°å­—ï¼šåœ¨ä¸€å°æ—¶å†…ï¼Œæ‰¾åˆ°ä¸‰ä¸ªè½¦ç‰Œå·å¸¦â€œ8â€çš„è½¦ã€‚",
        "å¹¿å‘Šè§£å¯†ï¼šè§‚å¯Ÿ5ä¸ªå¹¿å‘Šç‰Œï¼Œç”¨ä¸€å¥è¯æ€»ç»“å®ƒä»¬çš„ä¸»é¢˜ã€‚","åå­—é…å¯¹ï¼šæŒ‘3ä»¶ç‰©å“ï¼Œç»™å®ƒä»¬èµ·åå­—ï¼Œæ¯”å¦‚â€œç¬”å«é˜¿è“â€ã€‚",
        "å½±å­ç©å¶ï¼šç”¨æ‰‹å½±æˆ–è€…ç‰©å“å½±å­åˆ›é€ ä¸€ä¸ªç®€å•çš„â€œè¡¨æ¼”â€ã€‚","è¶³è¿¹æ¢ç´¢ï¼šæ‰¾ä¸€ä¸ªåœ°ä¸Šç‰¹æ®Šçš„è„šå°æˆ–è€…ç—•è¿¹ï¼Œæè¿°å®ƒåƒä»€ä¹ˆã€‚",
        "äº‘æœµæƒ³è±¡ï¼šçœ‹å¤©ä¸Šçš„äº‘ï¼Œæ‰¾åˆ°3æœµåƒæŸç§åŠ¨ç‰©çš„ã€‚","éšæœºæ–¹å‘ï¼šé—­çœ¼éšä¾¿æŒ‡ä¸€ä¸ªæ–¹å‘ï¼Œèµ°åˆ°100æ­¥åæè¿°ä½ çœ‹åˆ°çš„é£æ™¯ã€‚",
        "æ•°å­—æŒ‘æˆ˜ï¼šä»Šå¤©è§‚å¯Ÿåˆ°çš„æ¯ä¸ªæ•°å­—ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœ‰è¶£çš„è§„å¾‹ã€‚","å»ºç­‘å¯†ç ï¼šæŒ‘ä¸€ä¸ªå»ºç­‘ï¼Œæ‰¾å‡ºå®ƒ3ä¸ªä½ æ²¡æ³¨æ„è¿‡çš„å°ç»†èŠ‚ã€‚",
        "æ‹›ç‰Œè§‚å¯Ÿï¼šè®°ä¸‹è·¯ä¸Šçœ‹åˆ°3ä¸ªå•†åº—çš„åå­—ï¼Œé€‰ä¸€ä¸ªä½ è§‰å¾—æœ€å¥½å¬çš„ã€‚","å¯»æ‰¾ä¸‰è§’å½¢ï¼šä»Šå¤©æ‰¾åˆ°3ä¸ªä¸‰è§’å½¢çš„ç‰©å“ã€‚",
        "å£°éŸ³åœ°å›¾ï¼šé—­çœ¼å¬10ç§’é’Ÿï¼Œå†™ä¸‹ä½ å¬åˆ°çš„æ‰€æœ‰å£°éŸ³ã€‚","å½±å­è°œé¢˜ï¼šç”¨èº«è¾¹ç‰©å“çš„å½±å­åˆ›é€ ä¸€ä¸ªâ€œå°ç‹—â€çš„å½¢çŠ¶ã€‚"
      ],
      random: []
    };
    // å°†æ‰€æœ‰ä»»åŠ¡åˆå¹¶åˆ° random é‡Œ
    Object.values(tasksByCategory).forEach(categoryTasks => {
      if (categoryTasks !== tasksByCategory.random) {
        tasksByCategory.random.push(...categoryTasks);
      }
    });

    // å­˜å‚¨å·²å®Œæˆä»»åŠ¡
    let completedTasks = JSON.parse(localStorage.getItem("completedTasks")) || {};

    // ç”¨æˆ·ç§¯åˆ†
    let userPoints = parseInt(localStorage.getItem("userPoints")) || 0;
    const pointsDisplay = document.getElementById("points-value");

    // è¿ç»­å®Œæˆä»»åŠ¡è®¡æ•°ï¼ˆå½“æ—¥æ˜¯å¦å·²å®Œæˆä»»åŠ¡ + æœ¬å‘¨å¤©æ•°ç»Ÿè®¡ï¼‰
    let dailyTaskCount = 0; // ç”¨äºåˆ¤æ–­æ˜¯å¦è¾¾åˆ°3ä¸ªè¿ç»­ä»»åŠ¡
    // è®°å½•æœ€è¿‘è¿ç»­å®Œæˆä»»åŠ¡çš„å¤©æ•°
    let consecutiveDays = parseInt(localStorage.getItem("consecutiveDays")) || 0;
    let lastCompleteDate = localStorage.getItem("lastCompleteDate") || null;

    updatePointsDisplay();
    updateCompletedTasks(); // é¡µé¢åŠ è½½æ—¶æ›´æ–°

    // ç”Ÿæˆå¤šä¸ªä»»åŠ¡ï¼ˆæœ€å¤š3ä¸ªï¼‰
    function generateTasks(category) {
      const countInput = document.getElementById("task-count");
      let count = parseInt(countInput.value) || 1;
      if (count < 1) count = 1;
      if (count > 3) count = 3;
      countInput.value = count; // ç¡®ä¿è¾“å…¥æ¡†å†…æ˜¾ç¤ºæ­£ç¡®çš„å€¼
      const taskList = tasksByCategory[category];
      if (!taskList || taskList.length === 0) return;

      for (let i = 0; i < count; i++) {
        const randomIndex = Math.floor(Math.random() * taskList.length);
        const randomTask = taskList[randomIndex];
        addTaskToLog(randomTask, category);
      }
    }

    // å°†ä»»åŠ¡æ˜¾ç¤ºåˆ°â€œå¾…åšä»»åŠ¡â€åˆ—è¡¨
    function addTaskToLog(taskName, category) {
      const taskLog = document.getElementById("task-log");
      const li = document.createElement("li");
      li.innerHTML = `
        ${taskName}
        <button onclick="markTaskComplete(this, '${taskName}', '${category}')">å®Œæˆ</button>
      `;
      taskLog.appendChild(li);
    }

    // å®Œæˆä»»åŠ¡ï¼šåŠ¨ç”» + ç§¯åˆ† + è¿ç»­3ä¸ªä»»åŠ¡åˆ¤å®š + ç¼–è¾‘å¿ƒå¾—
    function markTaskComplete(button, task, category) {
      const li = button.parentElement;
      li.classList.add('task-complete-animation');

      // åŠ¨ç”»ç»“æŸåä»å¾…åšåˆ—è¡¨ç§»é™¤
      li.addEventListener('animationend', () => {
        li.remove();
      });

      // è·å–å¿ƒå¾—
      const reflection = prompt("è¯·ä¸ºå®Œæˆçš„ä»»åŠ¡æ·»åŠ å¿ƒå¾—ï¼š", "");

      // æ›´æ–°å·²å®Œæˆä»»åŠ¡è®°å½•
      const today = new Date().toISOString().split("T")[0];
      if (!completedTasks[today]) completedTasks[today] = [];
      completedTasks[today].push({ task, reflection });
      localStorage.setItem("completedTasks", JSON.stringify(completedTasks));
      updateCompletedTasks();

      // è®¡ç®—ç§¯åˆ†
      let earned = 0;
      if (category === 'exercise' || category === 'creativity') {
        earned = 2;
      } else if (category === 'study') {
        earned = 3;
      } else {
        // random => 1~3
        earned = Math.floor(Math.random() * 3) + 1;
      }

      userPoints += earned;
      dailyTaskCount += 1;

      // è¿ç»­ 3 ä¸ªä»»åŠ¡ => é¢å¤– +5
      if (dailyTaskCount === 3) {
        userPoints += 5;
        alert("æ­å–œå®Œæˆ 3 ä¸ªä»»åŠ¡ï¼Œå†é¢å¤– +5 åˆ†ï¼");
      }

      // 7 å¤©è¿ç»­æ‰“å¡åˆ¤æ–­
      updateConsecutiveDays(today);

      // æ›´æ–°ç§¯åˆ†
      localStorage.setItem("userPoints", userPoints);
      updatePointsDisplay();
    }

    // æ›´æ–°å½“æ—¥å·²å®Œæˆä»»åŠ¡ & å†å²è®°å½•
    function updateCompletedTasks() {
      const completedList = document.getElementById("completed-tasks");
      completedList.innerHTML = "";

      const today = new Date().toISOString().split("T")[0];
      const todayTasks = completedTasks[today] || [];

      todayTasks.forEach((item, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${item.task}
          ${item.reflection ? `<div class="reflection" onclick="editReflection('${today}', ${index})">å¿ƒå¾—ï¼š${item.reflection}</div>` : ''}
        `;
        completedList.appendChild(li);
      });

      updateTaskHistory();
    }

    // ç¼–è¾‘å¿ƒå¾—
    function editReflection(date, index) {
      const currentReflection = completedTasks[date][index].reflection || "";
      const newReflection = prompt("ç¼–è¾‘å¿ƒå¾—ï¼š", currentReflection);
      if (newReflection !== null) { // ç”¨æˆ·æ²¡æœ‰ç‚¹å‡»å–æ¶ˆ
        completedTasks[date][index].reflection = newReflection.trim();
        localStorage.setItem("completedTasks", JSON.stringify(completedTasks));
        updateCompletedTasks();
      }
    }

    // æ›´æ–°ä»»åŠ¡å†å²è®°å½•
    function updateTaskHistory() {
      const historyContainer = document.getElementById("task-history-container");
      historyContainer.innerHTML = "";

      Object.keys(completedTasks).forEach(date => {
        const entryDiv = document.createElement("div");
        entryDiv.style.marginBottom = "10px";

        const dateTitle = document.createElement("h4");
        dateTitle.innerText = date;
        dateTitle.style.cursor = "pointer";
        dateTitle.style.textDecoration = "underline";
        dateTitle.addEventListener("click", () => {
          const ul = entryDiv.querySelector("ul");
          ul.style.display = ul.style.display === "none" ? "block" : "none";
        });

        const ul = document.createElement("ul");
        ul.style.display = "none";

        completedTasks[date].forEach((item, idx) => {
          const li = document.createElement("li");
          li.innerHTML = `${item.task}${item.reflection ? ` - å¿ƒå¾—ï¼š${item.reflection}` : ''}`;
          ul.appendChild(li);
        });

        entryDiv.appendChild(dateTitle);
        entryDiv.appendChild(ul);
        historyContainer.appendChild(entryDiv);
      });
    }

    // æ¸…ç©ºå¾…åšä»»åŠ¡
    function clearTasks() {
      document.getElementById("task-log").innerHTML = "";
    }

    // ç§¯åˆ†æ˜¾ç¤º
    function updatePointsDisplay() {
      pointsDisplay.innerText = userPoints;
    }

    // è¿ç»­å®Œæˆå¤©æ•°åˆ¤æ–­
    function updateConsecutiveDays(today) {
      if (!lastCompleteDate) {
        // ç¬¬ä¸€æ¬¡è®°å½•
        consecutiveDays = 1;
      } else {
        // è®¡ç®—ä¸Šæ¬¡è®°å½•æ—¥å’Œä»Šå¤©çš„å·®
        const lastDateObj = new Date(lastCompleteDate);
        const todayObj = new Date(today);
        const diffTime = todayObj.getTime() - lastDateObj.getTime();
        const diffDays = Math.floor(diffTime / (1000 * 3600 * 24));

        if (diffDays === 1) {
          // æ­£å¥½éš”ä¸€å¤© => è¿ç»­å¤©æ•° +1
          consecutiveDays += 1;
        } else if (diffDays > 1) {
          // æ–­äº†ï¼Œé‡æ–°è®°
          consecutiveDays = 1;
        }
      }

      // å¦‚æœè¾¾åˆ° 7 å¤©å°±æç¤ºç¥ç§˜å¥–åŠ±
      if (consecutiveDays === 7) {
        alert("å“‡ï¼Œå·²ç»è¿ç»­ 7 å¤©å®Œæˆä»»åŠ¡ï¼è·å¾—ç¥ç§˜å¥–åŠ± ğŸ ï¼");
      }

      // æ›´æ–°æœ¬æ¬¡è®°å½•
      lastCompleteDate = today;
      localStorage.setItem("lastCompleteDate", lastCompleteDate);
      localStorage.setItem("consecutiveDays", consecutiveDays);
    }

    /************************************************
     *         ï¼ˆä¸‰ï¼‰å…‘æ¢å•†åŸ ç›¸å…³ä»£ç 
     ************************************************/
    let exchangeHistory = JSON.parse(localStorage.getItem("exchangeHistory")) || [];

    // åŠ è½½è‡ªå®šä¹‰å¥–åŠ±
    let customRewards = JSON.parse(localStorage.getItem("customRewards")) || [];

    function openShop() {
      document.getElementById("shop-modal").style.display = "block";
      renderShopItems();
      renderExchangeHistory();
    }

    function closeShop() {
      document.getElementById("shop-modal").style.display = "none";
    }

    function exchangeItem(itemName, cost) {
      if (userPoints < cost) {
        alert("ç§¯åˆ†ä¸è¶³ï¼Œå¿«å»å®Œæˆä»»åŠ¡èµšç§¯åˆ†å§~");
        return;
      }
      // æ‰£é™¤ç§¯åˆ†
      userPoints -= cost;
      localStorage.setItem("userPoints", userPoints);
      updatePointsDisplay();

      // è®°å½•å…‘æ¢å†å²
      const time = new Date().toLocaleString();
      exchangeHistory.push({ item: itemName, cost: cost, time: time });
      localStorage.setItem("exchangeHistory", JSON.stringify(exchangeHistory));

      alert(`å…‘æ¢æˆåŠŸï¼è·å¾—ã€${itemName}ã€‘ï¼Œæ¶ˆè€—ç§¯åˆ† ${cost}ã€‚`);
      renderExchangeHistory();
    }

    function renderExchangeHistory() {
      const historyList = document.getElementById("exchange-history-list");
      historyList.innerHTML = "";
      exchangeHistory.forEach(record => {
        const li = document.createElement("li");
        li.textContent = `[${record.time}] å…‘æ¢ ${record.item} - æ¶ˆè€— ${record.cost}åˆ†`;
        historyList.appendChild(li);
      });
    }

    // æ·»åŠ è‡ªå®šä¹‰å¥–åŠ±
    function addCustomReward() {
      const rewardNameInput = document.getElementById("custom-reward-name");
      const rewardCostInput = document.getElementById("custom-reward-cost");
      const rewardName = rewardNameInput.value.trim();
      const rewardCost = parseInt(rewardCostInput.value);

      if (!rewardName) {
        alert("è¯·è¾“å…¥å¥–åŠ±åç§°ï¼");
        return;
      }
      if (isNaN(rewardCost) || rewardCost < 1) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ•°ï¼");
        return;
      }

      // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„å¥–åŠ±åç§°
      const existingReward = [...customRewards, ...predefinedRewards].find(r => r.name === rewardName);
      if (existingReward) {
        alert("å¥–åŠ±åç§°å·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å¦ä¸€ä¸ªåç§°ï¼");
        return;
      }

      // æ·»åŠ åˆ°è‡ªå®šä¹‰å¥–åŠ±åˆ—è¡¨
      const newReward = { name: rewardName, cost: rewardCost };
      customRewards.push(newReward);
      localStorage.setItem("customRewards", JSON.stringify(customRewards));

      // æ¸…ç©ºè¾“å…¥æ¡†
      rewardNameInput.value = "";
      rewardCostInput.value = "";

      // é‡æ–°æ¸²æŸ“å•†åŸ
      renderShopItems();

      alert(`è‡ªå®šä¹‰å¥–åŠ±ã€${rewardName}ã€‘å·²æ·»åŠ ï¼Œéœ€ ${rewardCost} ç§¯åˆ†ï¼`);
    }

    // æ¸²æŸ“å•†åŸå¥–åŠ±é¡¹ç›®ï¼ŒåŒ…æ‹¬é¢„å®šä¹‰å’Œè‡ªå®šä¹‰å¥–åŠ±
    function renderShopItems() {
      const shopItemsContainer = document.getElementById("shop-items");
      shopItemsContainer.innerHTML = ""; // æ¸…ç©ºç°æœ‰é¡¹ç›®

      // é¢„å®šä¹‰å¥–åŠ±
      predefinedRewards.forEach(reward => {
        const div = document.createElement("div");
        div.classList.add("shop-item");
        div.innerHTML = `
          <span>${reward.icon} ${reward.name}ï¼ˆ${reward.cost}åˆ†ï¼‰</span>
          <button onclick="exchangeItem('${reward.name}', ${reward.cost})">å…‘æ¢</button>
        `;
        shopItemsContainer.appendChild(div);
      });

      // è‡ªå®šä¹‰å¥–åŠ±
      customRewards.forEach(reward => {
        const div = document.createElement("div");
        div.classList.add("shop-item");
        div.innerHTML = `
          <span>${reward.name}ï¼ˆ${reward.cost}åˆ†ï¼‰</span>
          <button onclick="exchangeItem('${reward.name}', ${reward.cost})">å…‘æ¢</button>
        `;
        shopItemsContainer.appendChild(div);
      });
    }

    // é¢„å®šä¹‰å¥–åŠ±åˆ—è¡¨ï¼ˆå·²æ›´æ¢ä¸ºç‰©è´¨å¥–åŠ±ï¼‰
    const predefinedRewards = [
      { name: "ğŸ°å°è›‹ç³•", icon: "ğŸ°", cost: 25 },
      { name: "ğŸ‘—å°è£™å­", icon: "ğŸ‘—", cost: 80 },
      { name: "ğŸ¥˜å¤§é¤", icon: "ğŸ¥˜", cost: 80 },
      { name: "ğŸ’…ğŸ»ç¾ç”²", icon: "ğŸ’…ğŸ»", cost: 90 },
      { name: "âœˆï¸æ—…æ¸¸", icon: "âœˆï¸", cost: 100 },
      { name: "ğŸ“±ç”µå­äº§å“", icon: "ğŸ“±", cost: 150 },
      { name: "ğŸ‘ æ–°é‹å­", icon: "ğŸ‘ ", cost: 90 },
      { name: "ğŸ’†ğŸ»â€â™€ï¸æŒ‰æ‘©", icon: "ğŸ’†ğŸ»â€â™€ï¸", cost: 60 }
    ];

    // åˆå§‹åŒ–å•†åŸé¡¹ç›®
    renderShopItems();

    /************************************************
     *     ï¼ˆå››ï¼‰ç•ªèŒ„é’Ÿ ç›¸å…³ä»£ç ï¼ˆä¼˜åŒ–åï¼‰
     ************************************************/
    let workTimeTimerVar = 25 * 60; // é»˜è®¤25åˆ†é’Ÿ
    let breakTimeTimerVar = 5 * 60;  // é»˜è®¤5åˆ†é’Ÿ
    let isWorkTimeTimerVar = true;   // æ˜¯å¦åœ¨å·¥ä½œæ—¶é—´
    let timerIntervalTimer = null;
    let remainingTimeTimer = workTimeTimerVar;

    const musicFilesTimer = {
      tick: "https://downsc.chinaz.net/Files/DownLoad/sound1/202311/y2237.mp3",
      music1: "https://tangguanzimusic.oss-cn-guangzhou.aliyuncs.com/Vincentz%20-%20Iced%20Americano.mp3",
      music2: "https://tangguanzimusic.oss-cn-guangzhou.aliyuncs.com/Monday.mp3",
      music3: "https://tangguanzimusic.oss-cn-guangzhou.aliyuncs.com/%E4%B8%80%E8%B5%B7.mp3",
      music4: "https://tangguanzimusic.oss-cn-guangzhou.aliyuncs.com/%E8%87%B3%E5%B0%91%E5%81%9A%E4%B8%80%E4%BB%B6%E7%A6%BB%E8%B0%B1%E7%9A%84%E4%BA%8B.mp3",
    };
    const backgroundMusicTimer = document.getElementById("background-music");
    const musicSelector = document.getElementById("music-selector");

    // åˆå§‹åŒ–é€‰æ‹©çš„éŸ³ä¹
    let selectedMusic = musicSelector.value;

    // ç›‘å¬éŸ³ä¹é€‰æ‹©å˜åŒ–
    musicSelector.addEventListener("change", () => {
      selectedMusic = musicSelector.value;
      if (!isWorkTimeTimerVar) { // åªæœ‰åœ¨ä¼‘æ¯æ—¶æ›´æ”¹éŸ³ä¹æ‰éœ€è¦ç«‹å³æ›´æ¢
        backgroundMusicTimer.src = musicFilesTimer[selectedMusic];
        backgroundMusicTimer.play();
      }
    });

    function updateDisplayTimer() {
      const minutes = Math.floor(remainingTimeTimer / 60);
      const seconds = remainingTimeTimer % 60;
      document.getElementById("timer-display").innerText = 
        `${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
    }

    function playMusicTimer() {
      if (isWorkTimeTimerVar) {
        backgroundMusicTimer.src = musicFilesTimer.tick;
        backgroundMusicTimer.loop = true;
      } else {
        backgroundMusicTimer.src = musicFilesTimer[selectedMusic];
        backgroundMusicTimer.loop = true; // ä¼‘æ¯æ—¶å¾ªç¯æ’­æ”¾
      }
      backgroundMusicTimer.play();
    }

    function startTimer() {
      // è¯»å–å¹¶æ›´æ–°å·¥ä½œå’Œä¼‘æ¯æ—¶é—´
      const workInput = parseInt(document.getElementById("work-duration").value);
      const breakInput = parseInt(document.getElementById("break-duration").value);
      workTimeTimerVar = (!isNaN(workInput) && workInput > 0) ? workInput * 60 : 25 * 60;
      breakTimeTimerVar = (!isNaN(breakInput) && breakInput > 0) ? breakInput * 60 : 5 * 60;

      // æ ¹æ®å½“å‰çŠ¶æ€è®¾ç½®å‰©ä½™æ—¶é—´
      remainingTimeTimer = isWorkTimeTimerVar ? workTimeTimerVar : breakTimeTimerVar;
      updateDisplayTimer();

      if (timerIntervalTimer) {
        // å¦‚æœè®¡æ—¶å™¨å·²ç»åœ¨è¿è¡Œï¼Œé‡æ–°å¯åŠ¨ä»¥åº”ç”¨æ–°çš„æ—¶é—´
        clearInterval(timerIntervalTimer);
        timerIntervalTimer = null;
      }

      playMusicTimer(); // æ’­æ”¾éŸ³æ•ˆæˆ–éŸ³ä¹
      timerIntervalTimer = setInterval(() => {
        if (remainingTimeTimer > 0) {
          remainingTimeTimer--;
          updateDisplayTimer();
        } else {
          clearInterval(timerIntervalTimer);
          timerIntervalTimer = null;
          isWorkTimeTimerVar = !isWorkTimeTimerVar;
          remainingTimeTimer = isWorkTimeTimerVar ? workTimeTimerVar : breakTimeTimerVar;
          document.getElementById("current-status").innerText = 
            `å½“å‰çŠ¶æ€ï¼š${isWorkTimeTimerVar ? "å·¥ä½œä¸­" : "ä¼‘æ¯ä¸­"}`;
          playMusicTimer();
          startTimer(); // è‡ªåŠ¨å¼€å§‹ä¸‹ä¸€ä¸ªçŠ¶æ€
        }
      }, 1000);
      document.getElementById("current-status").innerText = 
        `å½“å‰çŠ¶æ€ï¼š${isWorkTimeTimerVar ? "å·¥ä½œä¸­" : "ä¼‘æ¯ä¸­"}`;
    }

    function pauseTimer() {
      if (timerIntervalTimer) {
        clearInterval(timerIntervalTimer);
        timerIntervalTimer = null;
        document.getElementById("current-status").innerText = "å½“å‰çŠ¶æ€ï¼šæš‚åœä¸­";
        backgroundMusicTimer.pause();
      }
    }

    function resetTimer() {
      clearInterval(timerIntervalTimer);
      timerIntervalTimer = null;
      isWorkTimeTimerVar = true;
      const workInput = parseInt(document.getElementById("work-duration").value);
      workTimeTimerVar = (!isNaN(workInput) && workInput > 0) ? workInput * 60 : 25 * 60;
      const breakInput = parseInt(document.getElementById("break-duration").value);
      breakTimeTimerVar = (!isNaN(breakInput) && breakInput > 0) ? breakInput * 60 : 5 * 60;
      remainingTimeTimer = workTimeTimerVar;
      document.getElementById("current-status").innerText = "å½“å‰çŠ¶æ€ï¼šæœªå¼€å§‹";
      backgroundMusicTimer.pause();
      backgroundMusicTimer.currentTime = 0;
      updateDisplayTimer();
    }

   /************************************************
     *           ï¼ˆäº”ï¼‰ä¸»é¢˜åˆ‡æ¢ç›¸å…³ä»£ç 
     ************************************************/
    // ä¸»é¢˜åˆ—è¡¨ï¼Œæ·»åŠ å¯¹åº”çš„theme-color
    const themes = [
      { class: 'theme-pink', color: '#ff6f91' },
      { class: 'theme-blue', color: '#4facfe' },
      { class: 'theme-green', color: '#a8e063' },
      { class: 'theme-morandi', color: '#8e9aaf' },
      { class: 'theme-dopamine', color: '#ff9a9e' },
      { class: 'theme-cream', color: '#f6d365' },
      { class: 'theme-dark', color: '#bb86fc' }
    ];
    let currentThemeIndex = 0;
    
    // è·å– <meta name="theme-color"> å…ƒç´ 
    const themeColorMeta = document.querySelector('meta[name="theme-color"]');
    
    // ç‚¹å‡»æ ‡é¢˜åˆ‡æ¢ä¸»é¢˜
    const themeSwitcherElement = document.getElementById("theme-switcher");
    themeSwitcherElement.addEventListener("click", () => {
      currentThemeIndex = (currentThemeIndex + 1) % themes.length;
      const newTheme = themes[currentThemeIndex];
      document.body.classList.remove(...themes.map(t => t.class));
      document.body.classList.add(newTheme.class);
      
      // æ›´æ–° theme-color å…ƒç´ 
      if (themeColorMeta) {
        themeColorMeta.setAttribute('content', newTheme.color);
      }
      
      // å­˜å‚¨å½“å‰ä¸»é¢˜ç´¢å¼•
      localStorage.setItem("currentThemeIndex", currentThemeIndex);
    });

    // ç¼–è¾‘æ ‡é¢˜åŠŸèƒ½
    function editTitle() {
      const themeSwitcher = document.getElementById("theme-switcher");
      const newText = prompt("è¯·è¾“å…¥æ–°çš„æ ‡é¢˜æ–‡æœ¬ï¼š", themeSwitcher.innerText);
      if (newText !== null && newText.trim() !== "") {
        themeSwitcher.innerText = newText.trim();
        // ä¿å­˜è‡ªå®šä¹‰æ ‡é¢˜åˆ° localStorage
        localStorage.setItem("customTitle", newText.trim());
      }
    }

    // é¡µé¢åŠ è½½æ—¶åº”ç”¨å­˜å‚¨çš„ä¸»é¢˜
    document.addEventListener("DOMContentLoaded", () => {
      // ç°æœ‰çš„åˆå§‹åŒ–ä»£ç ...

      // åŠ è½½å­˜å‚¨çš„ä¸»é¢˜
      const storedThemeIndex = parseInt(localStorage.getItem("currentThemeIndex"));
      if (!isNaN(storedThemeIndex) && storedThemeIndex >= 0 && storedThemeIndex < themes.length) {
        currentThemeIndex = storedThemeIndex;
        const storedTheme = themes[currentThemeIndex];
        document.body.classList.add(storedTheme.class);
        if (themeColorMeta) {
          themeColorMeta.setAttribute('content', storedTheme.color);
        }
      }
    });


    /************************************************
     *         ï¼ˆå…­ï¼‰PWA æ³¨å†Œä»£ç 
     ************************************************/
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(registration => {
            console.log('ServiceWorker æ³¨å†ŒæˆåŠŸï¼š', registration);
          })
          .catch(error => {
            console.log('ServiceWorker æ³¨å†Œå¤±è´¥ï¼š', error);
          });
      });
    }
  </script>
</body>
</html>